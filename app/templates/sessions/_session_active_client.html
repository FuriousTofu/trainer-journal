{% set form_id = "edit-session-form" %}
{% set mode = "edit" %}

<h2 class="h2">
    Session with
    <a href="{{ url_for('.client', client_public_id=session.client.public_id) }}"
       class="link-primary text-decoration-none">
        {{ session.client.name }}
    </a>
    on {{ session.start_dt|dt_no_seconds }}
</h2>

<form method="post" novalidate class="add-form" id="edit-session-form">
    {{ form.hidden_tag() }}

    <div class="row g-2 mb-2">
        <div class="col-md-4">
            <div class="form-floating mb-2">
                {{ form.start_dt(class="form-control", type="datetime-local", placeholder="Start Date and Time") }}
                {{ form.start_dt.label(class="form-label") }}
                {% for error in form.start_dt.errors %}
                    <div class="text-danger small">{{ error }}</div>
                {% endfor %}
            </div>
        </div>

        <div class="col-md-4">
            <div class="form-floating mb-2">
                {{ form.status(class="form-select", placeholder="Status") }}
                {{ form.status.label(class="form-label") }}
                {% for error in form.status.errors %}
                    <div class="text-danger small">{{ error }}</div>
                {% endfor %}
            </div>
        </div>

        <div class="col-md-4">
            <div class="tj-form-field tj-form-field--switch mb-2">
                <label for="is_paid">Payment</label>
                <div class="form-check form-switch m-0">
                    {{ form.is_paid(class="form-check-input m-0", id="is_paid", role="switch") }}
                </div>
            </div>
            {% for error in form.is_paid.errors %}
                <div class="text-danger small">{{ error }}</div>
            {% endfor %}
        </div>
    </div>

    <div class="row g-2 mb-2">
        <div class="col-md-4">
            <div class="form-floating mb-2">
                {{ form.duration_min(class="form-control", placeholder="Duration (minutes)") }}
                {{ form.duration_min.label(class="form-label") }}
                {% for error in form.duration_min.errors %}
                    <div class="text-danger small">{{ error }}</div>
                {% endfor %}
            </div>
        </div>

        <div class="col-md-4">
            <div class="form-floating mb-2">
                {{ form.mode(class="form-select", placeholder="Session Mode") }}
                {{ form.mode.label(class="form-label") }}
                {% for error in form.mode.errors %}
                    <div class="text-danger small">{{ error }}</div>
                {% endfor %}
            </div>
        </div>

        <div class="col-md-4">
            <div id="price-wrapper">
                <div class="form-floating mb-2">
                    {{ form.price(class="form-control", placeholder="Session Price") }}
                    {{ form.price.label(class="form-label") }}
                    {% for error in form.price.errors %}
                        <div class="text-danger small">{{ error }}</div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <div id="exercise-wrapper">
        {% for subform in exercises_form.exercises %}
            {% include "helpers/_exercise_row.html" with context %}
        {% endfor %}
    </div>

    <div class="row g-2 mb-2">
        <div class="col">
            <button
                type="button"
                class="btn btn-outline-primary border-0 shadow-none js-add-exercise"
                hx-get="{{ url_for('.edit_exercise_row', session_public_id=session.public_id) }}"
                hx-target="#exercise-wrapper"
                hx-include="#edit-session-form"
                hx-swap="beforeend">
                + Add Exercise
            </button>
        </div>
    </div>

    <div class="form-floating mb-1">
        {{ form.notes(class="form-control", placeholder="Session Notes (Optional)") }}
        {{ form.notes.label(class="form-label") }}
        {% for error in form.notes.errors %}
            <div class="text-danger small">{{ error }}</div>
        {% endfor %}
    </div>
</form>

<div class="d-flex justify-content-center gap-2">
    <a href="{{ url_for('.sessions') }}" class="btn btn-outline-primary">
        <i class="bi bi-arrow-return-left"></i> Sessions
    </a>

    <form method="post"
          action="{{ url_for('.delete_session', session_public_id=session.public_id) }}"
          onsubmit="return confirm('Delete this session? This canâ€™t be undone.');"
          class="m-0">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <button type="submit" class="btn btn-outline-secondary">
            <i class="bi bi-trash"></i> Delete Session
        </button>
    </form>

    <button type="submit" form="edit-session-form" class="btn btn-primary px-3">
        Save Changes
    </button>
</div>

{% block scripts %}
    <script src="{{ url_for('static', filename='js/session-form.js') }}"></script>
{% endblock %}