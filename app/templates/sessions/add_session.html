{% extends "layout.html" %}

{% block title %}
    Add Session
{% endblock %}

{% block main %}
    {% set form_id = "add-session-form" %}
    {% set mode = "add" %}
    
    {% if not has_clients or not has_exercises %}
    <a href="{{ url_for('.add_client') }}" class="btn btn-outline-primary mb-3">
        <i class="bi bi-plus-circle"></i> Add Client
    </a>
    <a href="{{ url_for('.add_exercise') }}" class="btn btn-outline-primary mb-3">
        <i class="bi bi-plus-circle"></i> Add Exercise
    </a>
        <div class="d-flex justify-content-center align-items-center" style="min-height: 200px;">
            <div class="card shadow-sm border-0 text-center p-4" style="width: 300px;">
                <i class="bi bi-info-circle fs-1 mb-2"></i>
                <div>To add a session you need to have active clients and exercises.<br>Please add some to activate this view.</div>
            </div>  
        </div> 
    {% else %}
        <h2 class="h2">Add New Session</h2>
        <form method="post" action="{{ url_for('.add_session') }}" novalidate class="add-form" id="add-session-form">
            {{ form.hidden_tag() }}
            <div class="row g-2 mb-2">
                <div class="col-6">
                    <div class="form-floating">
                        {{ form.client(
                            class="form-select",
                            placeholder="Select Client"
                        ) }}
                        {{ form.client.label(class="form-label") }}
                        {% for error in form.client.errors %}
                            <div class="text-danger small">{{ error }}</div>
                        {% endfor %}
                    </div>
                </div>
                <div class="col-6">
                    <div class="form-floating">
                        {{ form.start_dt(
                            class="form-control",
                            type="datetime-local",
                            placeholder="Start Date and Time"
                        ) }}
                        {{ form.start_dt.label(class="form-label") }}
                        {% for error in form.start_dt.errors %}
                            <div class="text-danger small">{{ error }}</div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class="row g-2 mb-2">
                <div class="col-4">
                    <div class="form-floating">
                        {{ form.duration_min(class="form-control", placeholder="Duration (minutes)") }}
                        {{ form.duration_min.label(class="form-label") }}
                        {% for error in form.duration_min.errors %}
                            <div class="text-danger small">{{ error }}</div>
                        {% endfor %}
                    </div>
                </div>
                <div class="col-4">
                    <div class="form-floating">
                        {{ form.mode(
                            class="form-select",
                            placeholder="Session Mode"
                        ) }}
                        {{ form.mode.label(class="form-label") }}
                        {% for error in form.mode.errors %}
                            <div class="text-danger small">{{ error }}</div>
                        {% endfor %}
                    </div>
                </div>
                <div class="col-4">
                    <div id="price-wrapper">
                        <div class="form-floating">
                            {{ form.price(class="form-control", placeholder="Session Price") }}
                            {{ form.price.label(class="form-label") }}
                            {% for error in form.price.errors %}
                                <div class="text-danger small">{{ error }}</div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            <div id="exercise-wrapper">
                {% for subform in form.exercises %}
                    {% include "helpers/_exercise_row.html" with context %}
                {% endfor %}
            </div>
            <div class="row g-2 mb-2">
                <div class="col">
                    <button
                        type="button"
                        class="btn btn-link text-primary p-0 js-add-exercise"
                        hx-get="{{ url_for('.exercise_row') }}"
                        hx-target="#exercise-wrapper"
                        hx-include="#add-session-form"
                        hx-swap="beforeend">
                        <i class="bi bi-plus-circle fs-4"></i>
                    </button>
                </div>
            </div>
            <div class="form-floating mb-2">
                {{ form.notes(
                    class="form-control", 
                    placeholder="Session Notes (Optional)"
                ) }}
                {{ form.notes.label(class="form-label") }}
                {% for error in form.notes.errors %}
                    <div class="text-danger small">{{ error }}</div>
                {% endfor %}
            </div>
            <div class="d-flex justify-content-center gap-2 mt-3">
                <a href="{{ url_for('.sessions') }}" class="btn btn-outline-primary">
                    <i class="bi bi-arrow-return-left"></i>
                </a>
                {{ form.submit(class="btn btn-primary px-3") }}
            </div>
        </form>
            {% block scripts %}
                <script src="{{ url_for('static', filename='js/ex-history.js') }}"></script>
                <script src="{{ url_for('static', filename='js/session-form.js') }}"></script>
                {% if is_copy %}
                <script src="{{ url_for('static', filename='js/ex-init-trigger.js') }}"></script>
                {% endif %}
            {% endblock %}
    {% endif %}
{% endblock %}